<ng-container *ngIf="transactionService.getSelectedDate() | async as selectedDate">
  <ng-container *ngIf="transactionService.getSelectedTransactionType() | async as type">
    <ion-header #header [style.marginTop.px]="hideHeader ? -178 : 0" [translucent]="true"
                style="transition: all ease-in-out 1s">
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title class="ion-text-center">Manage Transactions</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="filterMenu.toggle(true)">
            <ion-icon name="filter-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
      <ion-toolbar>
        <ion-item>
          <app-date-navigator
            (selectedDateChange)="transactionService.updateSelectedDateType($event);transactionsPage.scrollToTop();"
            [selectedDate]="selectedDate"
            class="d-block w-100"></app-date-navigator>
        </ion-item>
      </ion-toolbar>
      <ion-toolbar>
        <ion-segment (ionChange)="onTypeSegmentChange($event)" [ngModel]="type">
          <ion-segment-button value="expenses">
            <ion-label>Expenses</ion-label>
          </ion-segment-button>
          <ion-segment-button value="income">
            <ion-label>Incomes</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-toolbar>
    </ion-header>
    <ion-content #transactionsPage (ionScroll)="hideHeaderClick($event)" [fullscreen]="true"
                 id="transactionsPage"
                 scrollEvents="true">

      <ion-list *ngIf="transactionService.getTransactions()|async as transactions">
        <h4 *ngIf="transactions.length === 0" class="text-center text-warning">
          No {{type|titlecase}} to show
          in {{selectedDate|date:'MMM-yyyy'}}
        </h4>
        <ng-container *ngFor="let group of transactions">
          <ion-item-group color="light" sticky>
            <ion-item-divider color="light" sticky>{{group.date}}</ion-item-divider>
            <ion-item-sliding #transactionSliding *ngFor="let transaction of group.transactions">
              <ion-item-options side="start">
                <ion-item-option
                  (click)="markAsPaid(markAsPaidTempRef,transaction.payment,transaction);transactionSliding.close();"
                  *ngIf="!transaction.isPaid" color="success" style="width: 100px;">
                  <div class="d-flex flex-column justify-content-center align-items-center w-100 h-100">
                    <span class="d-block text-white w-100 text-center" style="font-size: 10px;">Mark as</span>
                    <ion-label class="fw-bold">Paid</ion-label>
                  </div>
                </ion-item-option>
                <ion-item-option (click)="makeAsNotPaid(transaction);transactionSliding.close();"
                                 *ngIf="transaction.isPaid"
                                 color="danger"
                                 style="width: 100px;margin-right: 15px;">
                  <div class="d-flex flex-column justify-content-center align-items-center w-100 h-100">
                    <span class="d-block text-white w-100 text-center" style="font-size: 10px;">Mark as</span>
                    <ion-label class="fw-bold">Not Paid</ion-label>
                  </div>
                </ion-item-option>
              </ion-item-options>

              <ion-item (click)="showMoreDetail(transaction, selectedDate)" [detail]="true" lines="full"
                        style="--min-height: 80px;">
                <ion-label slot="start">
                  <h2 class="mb-2 fw-bold">{{transaction.name}} ({{transaction.installment}})</h2>
                  <ion-badge class="fw-normal" color="primary">
                    Due : {{transaction.dueDate|date:'dd-MMM-yyyy'}}
                  </ion-badge>
                </ion-label>
                <ion-label class="pe-2" slot="end">
                  <h4 class="fw-bold mb-2">{{transaction.amount | currency : 'INR'}}</h4>
                  <ion-badge [color]="transaction.isPaid ? 'success' : 'danger'" class="fw-normal"
                             style="width: 56px;">{{transaction.isPaid ? 'Paid' : 'Pending'}}</ion-badge>
                </ion-label>
              </ion-item>

              <ion-item-options side="end">
                <ion-item-option (click)="deleteTransaction(transaction);transactionSliding.close();" color="danger"
                                 style="width: 80px;">Delete
                </ion-item-option>
                <ion-item-option
                  (click)="editTransactionClick(transactionSliding, transaction, selectedDate);$event.stopPropagation();"
                  color="warning"
                  style="width: 80px;margin-right: 15px;">Edit
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>
          </ion-item-group>
        </ng-container>
      </ion-list>

      <ion-fab *ngIf="transactionService.getSelectedTransactionType() | async as type" [edge]="false" class="me-3 mb-3"
               horizontal="end" slot="fixed"
               vertical="bottom">
        <ion-fab-button (click)="addNewExpenses(type)">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
      </ion-fab>


    </ion-content>
    <ion-menu #filterMenu contentId="transactionsPage" menuId="first" side="end">
      <ion-header *ngIf="transactionService.getSelectedTransactionType() | async as type">
        <ion-toolbar>
          <ion-title>{{type|titlecase}} Filter</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item>Menu Item</ion-item>
          <ion-item>Menu Item</ion-item>
          <ion-item>Menu Item</ion-item>
          <ion-item>Menu Item</ion-item>
          <ion-item>Menu Item</ion-item>
        </ion-list>
      </ion-content>
    </ion-menu>

  </ng-container>
</ng-container>

<ng-template #markAsPaidTempRef>
  <h1 mat-dialog-title>Mark as Paid</h1>
  <form #sampleForm="ngForm" mat-dialog-content>
    <p>Mark {{selectedPayment.instalment}} instalment ({{selectedPayment.dueDateString}}) as Paid
      for {{selectedTransaction.name}}</p>
    <mat-form-field appearance="legacy" class="w-100">
      <mat-label>Payment Date</mat-label>
      <input [matDatepicker]="picker" [ngModel]="defaultDate" matInput name="paidOn" placeholder="MM/DD/YYYY" required>
      <mat-datepicker-toggle [for]="picker" matSuffix></mat-datepicker-toggle>
      <mat-datepicker #picker touchUi></mat-datepicker>
    </mat-form-field>
    <!--<pre>{{selectedPayment|json}}</pre>-->
  </form>
  <div mat-dialog-actions>
    <div class="d-flex w-100 flex-row justify-content-between">
      <div class="col-5">
        <button class="w-100" mat-dialog-close mat-raised-button>No Thanks</button>
      </div>
      <div class="col-5">
        <button (click)="addPayment(sampleForm)" class="w-100" color="primary" mat-raised-button>Mark as Paid</button>
      </div>
    </div>
  </div>
</ng-template>
